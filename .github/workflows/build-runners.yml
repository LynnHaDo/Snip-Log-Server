name: Build and Push Runner Images

# This 'on' block is the trigger.
# It runs this workflow automatically on any 'push' (commit)
# that happens inside the 'runner-images/' folder on 'main' branch.
on:
  push:
    branches: [ "main" ]
    paths: [ "runner-images/**" ]

  # This allows running this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build-and-push:
    # This job runs on a virtual machine hosted by GitHub
    runs-on: ubuntu-latest

    # This 'permissions' block is CRITICAL.
    # It gives the workflow a special, temporary token
    # to let it write (push) to your container registry.
    permissions:
      contents: read
      packages: write # This is the permission to push to GHCR

    steps:
      # 1. Check out your repository's code
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Log in to the GitHub Container Registry (GHCR)
      # This uses the magic GITHUB_TOKEN so you don't need passwords.
      - name: Log in to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.repository_owner }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # --- BUILD AND PUSH PYTHON 3.10 ---
      - name: Build and push python-runner:3.10.0
        uses: docker/build-push-action@v5
        with:
          context: ./runner-images # Where to find the Dockerfiles
          file: ./runner-images/Dockerfile.python # Which Dockerfile to use
          build-args: |
            PYTHON_VERSION=3.10.0-slim
          push: true # Actually push the image
          tags: ghcr.io/YOUR_USERNAME/python-runner:3.10.0 # The full name

      # --- BUILD AND PUSH NODE.JS 18 ---
      - name: Build and push node-runner:18.0.0
        uses: docker/build-push-action@v5
        with:
          context: ./runner-images
          file: ./runner-images/Dockerfile.node
          build-args: |
            NODE_VERSION=18-alpine
          push: true
          tags: ghcr.io/YOUR_USERNAME/node-runner:18.0.0
      
      